<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: header}"></head>

<body class="admin-body">

<!-- Admin Navigation -->
<div th:replace="~{admin/fragments/admin-navbar :: admin-navbar}"></div>

<div class="admin-container">
    <!-- Admin Sidebar -->
            <!-- Include Sidebar -->
        <div th:replace="admin/fragments/admin-sidebar :: sidebar"></div>

    <!-- Main Content -->
    <main class="admin-main-content">
        <div class="admin-header">
            <div class="header-content">
                <a href="/admin/movies/list" class="back-btn">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                    Quay l·∫°i
                </a>
                <h1 th:text="${movie != null ? 'Ch·ªânh s·ª≠a phim' : 'Th√™m phim m·ªõi'}">Th√™m phim m·ªõi</h1>
            </div>
        </div>

        <div class="form-container">
            <form class="movie-form" method="post" enctype="multipart/form-data">
                <div class="form-grid">
                    <!-- Left Column - Basic Info -->
                    <div class="form-section">
                        <h3>Th√¥ng tin c∆° b·∫£n</h3>
                        
                        <div class="form-group">
                            <label for="title" class="required">T√™n phim</label>
                            <input type="text" id="title" name="title" 
                                   th:value="${movie?.title}" 
                                   placeholder="Nh·∫≠p t√™n phim..." required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="genre">Th·ªÉ lo·∫°i</label>
                                <input type="text" id="genre" name="genre" 
                                       th:value="${movie?.genre}" 
                                       placeholder="H√†nh ƒë·ªông, Phi√™u l∆∞u...">
                            </div>
                            <div class="form-group">
                                <label for="rating">Ph√¢n lo·∫°i ƒë·ªô tu·ªïi</label>
                                <select id="rating" name="rating">
                                    <option value="">Ch·ªçn ƒë·ªô tu·ªïi</option>
                                    <option value="P" th:selected="${movie?.rating == 'P'}">P - Ph√π h·ª£p m·ªçi l·ª©a tu·ªïi</option>
                                    <option value="K" th:selected="${movie?.rating == 'K'}">K - D∆∞·ªõi 13 tu·ªïi c√≥ cha m·∫π ƒëi k√®m</option>
                                    <option value="T13" th:selected="${movie?.rating == 'T13'}">T13 - T·ª´ 13 tu·ªïi tr·ªü l√™n</option>
                                    <option value="T16" th:selected="${movie?.rating == 'T16'}">T16 - T·ª´ 16 tu·ªïi tr·ªü l√™n</option>
                                    <option value="T18" th:selected="${movie?.rating == 'T18'}">T18 - T·ª´ 18 tu·ªïi tr·ªü l√™n</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="duration">Th·ªùi l∆∞·ª£ng (ph√∫t)</label>
                                <input type="number" id="duration" name="duration" 
                                       th:value="${movie?.duration}" 
                                       min="1" max="300" placeholder="120">
                            </div>
                            <div class="form-group">
                                <label for="status">Tr·∫°ng th√°i</label>
                                <select id="status" name="status">
                                    <option value="COMING_SOON" th:selected="${movie?.status == 'COMING_SOON'}">S·∫Øp chi·∫øu</option>
                                    <option value="NOW_SHOWING" th:selected="${movie?.status == 'NOW_SHOWING'}">ƒêang chi·∫øu</option>
                                    <option value="ENDED" th:selected="${movie?.status == 'ENDED'}">Ng·ª´ng chi·∫øu</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="releaseDate">Ng√†y kh·ªüi chi·∫øu</label>
                            <input type="date" id="releaseDate" name="releaseDate" 
                                   th:value="${movie?.releaseDate}">
                        </div>

                        <div class="form-group">
                            <label for="synopsis">T√≥m t·∫Øt n·ªôi dung</label>
                            <textarea id="synopsis" name="synopsis" rows="4" 
                                      placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ n·ªôi dung phim..."
                                      th:text="${movie?.synopsis}"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="director">ƒê·∫°o di·ªÖn</label>
                            <input type="text" id="director" name="director" 
                                   th:value="${movie?.director}" 
                                   placeholder="T√™n ƒë·∫°o di·ªÖn...">
                        </div>

                        <div class="form-group">
                            <label for="cast">Di·ªÖn vi√™n ch√≠nh</label>
                            <textarea id="cast" name="cast" rows="3" 
                                      placeholder="T√™n c√°c di·ªÖn vi√™n ch√≠nh, c√°ch nhau b·ªüi d·∫•u ph·∫©y..."
                                      th:text="${movie?.cast}"></textarea>
                        </div>
                    </div>

                    <!-- Right Column - Media & Advanced -->
                    <div class="form-section">
                        <h3>H√¨nh ·∫£nh & Th√¥ng tin n√¢ng cao</h3>
                        
                        <!-- Poster Upload -->
                        <div class="form-group">
                            <label for="poster">Poster phim</label>
                            <div class="file-upload-container">
                                <div class="poster-preview" th:if="${movie?.poster}">
                                    <img th:src="${movie.poster}" alt="Current poster" id="currentPoster">
                                </div>
                                <div class="file-upload-area" onclick="document.getElementById('poster').click()">
                                    <div class="upload-icon">üìÅ</div>
                                    <p>K√©o th·∫£ file ho·∫∑c click ƒë·ªÉ ch·ªçn</p>
                                    <small>PNG, JPG, WEBP (t·ªëi ƒëa 5MB)</small>
                                </div>
                                <input type="file" id="poster" name="poster" 
                                       accept="image/png,image/jpg,image/jpeg,image/webp" 
                                       style="display: none;" onchange="previewPoster(event)">
                            </div>
                        </div>

                        <!-- Trailer -->
                        <div class="form-group">
                            <label for="trailerUrl">Link trailer (YouTube)</label>
                            <input type="url" id="trailerUrl" name="trailerUrl" 
                                   th:value="${movie?.trailerUrl}" 
                                   placeholder="https://www.youtube.com/watch?v=...">
                        </div>

                        <!-- Language -->
                        <div class="form-group">
                            <label for="language">Ng√¥n ng·ªØ</label>
                            <select id="language" name="language">
                                <option value="">Ch·ªçn ng√¥n ng·ªØ</option>
                                <option value="vi" th:selected="${movie?.language == 'vi'}">Ti·∫øng Vi·ªát</option>
                                <option value="en" th:selected="${movie?.language == 'en'}">Ti·∫øng Anh</option>
                                <option value="ko" th:selected="${movie?.language == 'ko'}">Ti·∫øng H√†n</option>
                                <option value="ja" th:selected="${movie?.language == 'ja'}">Ti·∫øng Nh·∫≠t</option>
                                <option value="zh" th:selected="${movie?.language == 'zh'}">Ti·∫øng Trung</option>
                            </select>
                        </div>

                        <!-- Subtitle -->
                        <div class="form-group">
                            <label>Ph·ª• ƒë·ªÅ</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="subtitles" value="vi" 
                                           th:checked="${movie?.subtitles != null && movie.subtitles.contains('vi')}">
                                    <span class="checkmark"></span>
                                    Ti·∫øng Vi·ªát
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="subtitles" value="en"
                                           th:checked="${movie?.subtitles != null && movie.subtitles.contains('en')}">
                                    <span class="checkmark"></span>
                                    Ti·∫øng Anh
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="subtitles" value="ko"
                                           th:checked="${movie?.subtitles != null && movie.subtitles.contains('ko')}">
                                    <span class="checkmark"></span>
                                    Ti·∫øng H√†n
                                </label>
                            </div>
                        </div>

                        <!-- Format -->
                        <div class="form-group">
                            <label>ƒê·ªãnh d·∫°ng chi·∫øu</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="formats" value="2D" 
                                           th:checked="${movie?.formats != null && movie.formats.contains('2D')}">
                                    <span class="checkmark"></span>
                                    2D
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="formats" value="3D"
                                           th:checked="${movie?.formats != null && movie.formats.contains('3D')}">
                                    <span class="checkmark"></span>
                                    3D
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="formats" value="IMAX"
                                           th:checked="${movie?.formats != null && movie.formats.contains('IMAX')}">
                                    <span class="checkmark"></span>
                                    IMAX
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="formats" value="4DX"
                                           th:checked="${movie?.formats != null && movie.formats.contains('4DX')}">
                                    <span class="checkmark"></span>
                                    4DX
                                </label>
                            </div>
                        </div>

                        <!-- Pricing Info -->
                        <div class="pricing-section">
                            <h4>Th√¥ng tin gi√° v√©</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="basePrice">Gi√° c∆° b·∫£n</label>
                                    <div class="input-with-suffix">
                                        <input type="number" id="basePrice" name="basePrice" 
                                               th:value="${movie?.basePrice}" 
                                               min="0" step="1000" placeholder="80000">
                                        <span class="suffix">VND</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="weekendPrice">Gi√° cu·ªëi tu·∫ßn</label>
                                    <div class="input-with-suffix">
                                        <input type="number" id="weekendPrice" name="weekendPrice" 
                                               th:value="${movie?.weekendPrice}" 
                                               min="0" step="1000" placeholder="100000">
                                        <span class="suffix">VND</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="history.back()">
                        H·ªßy
                    </button>
                    <button type="button" class="btn btn-outline" onclick="saveDraft()">
                        L∆∞u nh√°p
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <span th:text="${movie != null ? 'C·∫≠p nh·∫≠t phim' : 'Th√™m phim'}">Th√™m phim</span>
                    </button>
                </div>
            </form>
        </div>
    </main>
</div>

<!-- Success Modal -->
<div class="modal" id="successModal" style="display: none;">
    <div class="modal-content success">
        <div class="modal-header">
            <div class="success-icon">‚úÖ</div>
            <h3>Th√†nh c√¥ng!</h3>
        </div>
        <div class="modal-body">
            <p id="successMessage">Phim ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="closeSuccessModal()">OK</button>
        </div>
    </div>
</div>

<style>
.form-container {
    max-width: 1200px;
    margin: 0 auto;
}

.movie-form {
    background: #1F1F1F;
    border-radius: 12px;
    border: 1px solid #333;
    overflow: hidden;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
}

.form-section {
    padding: 2rem;
    border-right: 1px solid #333;
}

.form-section:last-child {
    border-right: none;
}

.form-section h3 {
    color: #FFFFFF;
    margin: 0 0 1.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
    border-bottom: 2px solid #E50914;
    padding-bottom: 0.5rem;
}

.form-section h4 {
    color: #E50914;
    margin: 1.5rem 0 1rem 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-group label {
    display: block;
    color: #B3B3B3;
    font-weight: 500;
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
}

.form-group label.required::after {
    content: ' *';
    color: #E50914;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    background: #333;
    border: 1px solid #555;
    border-radius: 8px;
    padding: 0.75rem;
    color: #FFFFFF;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    box-sizing: border-box;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #E50914;
    box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2);
}

.form-group textarea {
    resize: vertical;
    font-family: inherit;
}

.input-with-suffix {
    position: relative;
    display: flex;
    align-items: center;
}

.input-with-suffix input {
    padding-right: 4rem;
}

.suffix {
    position: absolute;
    right: 0.75rem;
    color: #B3B3B3;
    font-size: 0.9rem;
}

.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #B3B3B3;
    cursor: pointer;
    font-weight: normal;
    margin-bottom: 0;
}

.checkbox-label input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.checkmark {
    font-size: 0.9rem;
}

.file-upload-container {
    border: 2px dashed #555;
    border-radius: 8px;
    overflow: hidden;
    position: relative;
}

.poster-preview {
    text-align: center;
    padding: 1rem;
    background: #2A2A2A;
}

.poster-preview img {
    max-width: 200px;
    max-height: 300px;
    border-radius: 8px;
    object-fit: cover;
}

.file-upload-area {
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.file-upload-area:hover {
    background: #2A2A2A;
    border-color: #E50914;
}

.upload-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #666;
}

.file-upload-area p {
    color: #B3B3B3;
    margin: 0.5rem 0;
    font-size: 1rem;
}

.file-upload-area small {
    color: #666;
    font-size: 0.85rem;
}

.pricing-section {
    background: #2A2A2A;
    padding: 1.5rem;
    border-radius: 8px;
    margin-top: 1rem;
}

.form-actions {
    padding: 2rem;
    border-top: 1px solid #333;
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    background: #1A1A1A;
}

.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: #B3B3B3;
    text-decoration: none;
    font-size: 0.95rem;
    margin-bottom: 1rem;
    transition: color 0.2s ease;
}

.back-btn:hover {
    color: #E50914;
}

.header-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.modal.success .modal-content {
    text-align: center;
}

.success-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.modal-body p {
    color: #B3B3B3;
    font-size: 1.1rem;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .form-section {
        border-right: none;
        border-bottom: 1px solid #333;
    }
    
    .form-section:last-child {
        border-bottom: none;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column-reverse;
    }
}
</style>

<script>
function previewPoster(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const currentPoster = document.getElementById('currentPoster');
            if (currentPoster) {
                currentPoster.src = e.target.result;
            } else {
                const preview = document.querySelector('.poster-preview');
                if (!preview) {
                    const container = document.querySelector('.file-upload-container');
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'poster-preview';
                    previewDiv.innerHTML = `<img src="${e.target.result}" alt="Preview" id="currentPoster">`;
                    container.insertBefore(previewDiv, container.firstChild);
                }
            }
        };
        reader.readAsDataURL(file);
    }
}

function saveDraft() {
    showSuccessModal('Phim ƒë√£ ƒë∆∞·ª£c l∆∞u d∆∞·ªõi d·∫°ng nh√°p.');
}

function showSuccessModal(message) {
    document.getElementById('successMessage').textContent = message;
    document.getElementById('successModal').style.display = 'flex';
}

function closeSuccessModal() {
    document.getElementById('successModal').style.display = 'none';
}

// Form validation
document.querySelector('.movie-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Basic validation
    const title = document.getElementById('title').value.trim();
    if (!title) {
        alert('Vui l√≤ng nh·∫≠p t√™n phim');
        return;
    }
    
    // Mock form submission
    showSuccessModal('Phim ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!');
    
    // In real implementation, you would submit the form data
    setTimeout(() => {
        closeSuccessModal();
        // Redirect to movies list
        window.location.href = '/admin/movies/list';
    }, 2000);
});

// Auto-format price inputs
document.getElementById('basePrice')?.addEventListener('input', function(e) {
    const value = e.target.value.replace(/\D/g, '');
    e.target.value = value;
});

document.getElementById('weekendPrice')?.addEventListener('input', function(e) {
    const value = e.target.value.replace(/\D/g, '');
    e.target.value = value;
});
</script>

</body>
</html>