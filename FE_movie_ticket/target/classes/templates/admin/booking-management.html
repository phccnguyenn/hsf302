<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: header}"></head>

<body class="admin-body">

<!-- Admin Navigation -->
<div th:replace="~{admin/fragments/admin-navbar :: admin-navbar}"></div>

<div class="admin-container">
    <!-- Admin Sidebar -->
            <!-- Include Sidebar -->
        <div th:replace="admin/fragments/admin-sidebar :: sidebar"></div>

    <!-- Main Content -->
    <main class="admin-main-content">
        <div class="admin-header">
            <h1>Qu·∫£n l√Ω ƒê·∫∑t v√©</h1>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-value" th:text="${totalBookingsToday}">0</span>
                    <span class="stat-label">T·ªïng ƒë·∫∑t v√© h√¥m nay</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value confirmed" th:text="${confirmedBookings}">0</span>
                    <span class="stat-label">ƒê√£ x√°c nh·∫≠n</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value cancelled" th:text="${cancelledBookings}">0</span>
                    <span class="stat-label">ƒê√£ h·ªßy</span>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-group">
                    <label>Ng√†y:</label>
                    <input type="date" class="form-control" id="dateFilter" 
                           th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}">
                </div>
                <div class="filter-group">
                    <label>Tr·∫°ng th√°i:</label>
                    <select class="form-select" id="statusFilter">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="confirmed">ƒê√£ x√°c nh·∫≠n</option>
                        <option value="pending">Ch·ªù x·ª≠ l√Ω</option>
                        <option value="cancelled">ƒê√£ h·ªßy</option>
                        <option value="refunded">ƒê√£ ho√†n ti·ªÅn</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>R·∫°p chi·∫øu:</label>
                    <select class="form-select" id="cinemaFilter">
                        <option value="">T·∫•t c·∫£ r·∫°p</option>
                        <option value="vincom">CGV Vincom Center</option>
                        <option value="landmark">CGV Landmark 81</option>
                        <option value="bitexco">CGV Bitexco</option>
                        <option value="diamond">CGV Diamond Plaza</option>
                    </select>
                </div>
                <div class="search-group">
                    <input type="text" placeholder="T√¨m theo m√£ v√© ho·∫∑c t√™n kh√°ch h√†ng..." 
                           class="search-input" id="bookingSearch">
                    <button class="search-btn">üîç</button>
                </div>
            </div>
        </div>

        <!-- Bookings Table -->
        <div class="content-card">
            <div class="table-header">
                <h3>Danh s√°ch ƒë·∫∑t v√© h√¥m nay</h3>
                <div class="table-actions">
                    <button class="btn btn-outline" onclick="exportBookings()">
                        üìä Xu·∫•t b√°o c√°o
                    </button>
                    <button class="btn btn-secondary" onclick="refreshBookings()">
                        üîÑ L√†m m·ªõi
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="admin-table bookings-table">
                    <thead>
                        <tr>
                            <th>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="selectAll">
                                    <span class="checkmark"></span>
                                </label>
                            </th>
                            <th>M√£ v√©</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>Phim</th>
                            <th>R·∫°p chi·∫øu</th>
                            <th>Su·∫•t chi·∫øu</th>
                            <th>Gh·∫ø</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="booking : ${todayBookings}">
                            <td>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="selectedBooking" th:value="${booking.id}">
                                    <span class="checkmark"></span>
                                </label>
                            </td>
                            <td>
                                <strong th:text="${booking.id}">#TK1234</strong>
                                <br><small th:text="${#temporals.format(#temporals.createNow(), 'dd/MM HH:mm')}">10/11 14:30</small>
                            </td>
                            <td>
                                <div class="customer-info">
                                    <strong th:text="${booking.customerName}">Nguyen Van A</strong>
                                    <br><small th:text="${booking.customerPhone ?: ''}">0901234567</small>
                                </div>
                            </td>
                            <td>
                                <div class="movie-info">
                                    <strong th:text="${booking.movie}">Spider-Man</strong>
                                    <br><small th:text="${booking.movieFormat ?: '2D'}">2D</small>
                                </div>
                            </td>
                            <td th:text="${booking.cinema}">CGV Vincom Center</td>
                            <td>
                                <div class="showtime-info">
                                    <strong th:text="${booking.time}">19:30</strong>
                                    <br><small th:text="${booking.screen ?: 'Screen 1'}">Screen 1</small>
                                </div>
                            </td>
                            <td>
                                <span class="seats-info" th:text="${booking.seats ?: 'A1, A2'}">A1, A2</span>
                            </td>
                            <td>
                                <strong th:text="${#numbers.formatDecimal(booking.amount, 0, 'COMMA', 0, 'POINT')} + ' VND'">240,000 VND</strong>
                                <br><small th:text="${booking.paymentMethod ?: 'Card'}">Card</small>
                            </td>
                            <td>
                                <span class="status-badge" 
                                      th:classappend="${booking.status}"
                                      th:text="${booking.status == 'confirmed' ? 'ƒê√£ x√°c nh·∫≠n' : 
                                                (booking.status == 'pending' ? 'Ch·ªù x·ª≠ l√Ω' : 
                                                (booking.status == 'cancelled' ? 'ƒê√£ h·ªßy' : 'ƒê√£ ho√†n ti·ªÅn'))}">ƒê√£ x√°c nh·∫≠n</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action btn-view" th:onclick="'viewBooking(' + ${booking.id} + ')'" title="Xem chi ti·∫øt">üëÅÔ∏è</button>
                                    <button class="btn-action btn-edit" th:onclick="'editBooking(' + ${booking.id} + ')'" title="Ch·ªânh s·ª≠a">‚úèÔ∏è</button>
                                    <button class="btn-action btn-print" th:onclick="'printTicket(' + ${booking.id} + ')'" title="In v√©">üñ®Ô∏è</button>
                                    <div class="dropdown">
                                        <button class="btn-action btn-more" title="Th√™m">‚ãÆ</button>
                                        <div class="dropdown-content">
                                            <a href="#" th:onclick="'confirmBooking(' + ${booking.id} + ')'">X√°c nh·∫≠n</a>
                                            <a href="#" th:onclick="'cancelBooking(' + ${booking.id} + ')'">H·ªßy v√©</a>
                                            <a href="#" th:onclick="'refundBooking(' + ${booking.id} + ')'">Ho√†n ti·ªÅn</a>
                                            <a href="#" th:onclick="'sendEmail(' + ${booking.id} + ')'">G·ª≠i email</a>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulkActions" style="display: none;">
                <div class="bulk-info">
                    <span id="selectedCount">0</span> v√© ƒë∆∞·ª£c ch·ªçn
                </div>
                <div class="bulk-buttons">
                    <button class="btn btn-primary" onclick="bulkConfirm()">X√°c nh·∫≠n t·∫•t c·∫£</button>
                    <button class="btn btn-warning" onclick="bulkCancel()">H·ªßy t·∫•t c·∫£</button>
                    <button class="btn btn-secondary" onclick="bulkExport()">Xu·∫•t b√°o c√°o</button>
                </div>
            </div>

            <!-- Table Pagination -->
            <div class="table-pagination">
                <div class="pagination-info">
                    Hi·ªÉn th·ªã <span th:text="${#lists.size(todayBookings)}">0</span> ƒë·∫∑t v√©
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" disabled>‚Üê Tr∆∞·ªõc</button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">3</button>
                    <button class="pagination-btn">Sau ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Quick Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card revenue">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                    <h3>Doanh thu h√¥m nay</h3>
                    <p class="stat-number">15,750,000 VND</p>
                    <span class="stat-change positive">+12.5%</span>
                </div>
            </div>
            <div class="stat-card popular">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-info">
                    <h3>Phim ph·ªï bi·∫øn nh·∫•t</h3>
                    <p class="stat-number">Spider-Man</p>
                    <span class="stat-change">125 v√©</span>
                </div>
            </div>
            <div class="stat-card peak">
                <div class="stat-icon">üìà</div>
                <div class="stat-info">
                    <h3>Gi·ªù cao ƒëi·ªÉm</h3>
                    <p class="stat-number">19:30 - 21:30</p>
                    <span class="stat-change">58% t·ªïng v√©</span>
                </div>
            </div>
            <div class="stat-card refund">
                <div class="stat-icon">‚Ü©Ô∏è</div>
                <div class="stat-info">
                    <h3>T·ª∑ l·ªá ho√†n ti·ªÅn</h3>
                    <p class="stat-number">2.3%</p>
                    <span class="stat-change negative">-0.5%</span>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Booking Detail Modal -->
<div class="modal" id="bookingDetailModal" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h3>Chi ti·∫øt ƒë·∫∑t v√©</h3>
            <button class="close-modal" onclick="closeBookingModal()">&times;</button>
        </div>
        <div class="modal-body" id="bookingDetails">
            <!-- Booking details will be populated here -->
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeBookingModal()">ƒê√≥ng</button>
            <button type="button" class="btn btn-primary" onclick="printTicket()">In v√©</button>
        </div>
    </div>
</div>

<style>
.header-stats {
    display: flex;
    gap: 2rem;
    margin-top: 1rem;
}

.stat-item {
    text-align: center;
}

.stat-value {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: #FFFFFF;
}

.stat-value.confirmed {
    color: #28a745;
}

.stat-value.cancelled {
    color: #dc3545;
}

.stat-label {
    font-size: 0.85rem;
    color: #B3B3B3;
}

.filter-section {
    background: #1F1F1F;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid #333;
}

.filter-row {
    display: flex;
    gap: 1.5rem;
    align-items: end;
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.filter-group label {
    font-size: 0.9rem;
    color: #B3B3B3;
    font-weight: 500;
}

.search-group {
    flex: 1;
    min-width: 300px;
    display: flex;
    gap: 0;
}

.search-input {
    flex: 1;
    padding: 0.75rem;
    background: #333;
    border: 1px solid #555;
    border-right: none;
    border-radius: 6px 0 0 6px;
    color: #FFFFFF;
    font-size: 0.95rem;
}

.search-btn {
    padding: 0.75rem 1rem;
    background: #E50914;
    border: 1px solid #E50914;
    border-radius: 0 6px 6px 0;
    color: white;
    cursor: pointer;
    font-size: 0.9rem;
}

.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #333;
}

.table-actions {
    display: flex;
    gap: 1rem;
}

.bookings-table {
    font-size: 0.9rem;
}

.bookings-table th {
    font-weight: 600;
    color: #FFFFFF;
    background: #2A2A2A;
    padding: 1rem 0.75rem;
}

.bookings-table td {
    padding: 1rem 0.75rem;
    vertical-align: top;
}

.customer-info strong,
.movie-info strong,
.showtime-info strong {
    color: #FFFFFF;
}

.customer-info small,
.movie-info small,
.showtime-info small {
    color: #B3B3B3;
}

.seats-info {
    background: #333;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    color: #E50914;
    font-weight: 500;
    font-size: 0.85rem;
}

.status-badge {
    padding: 0.35rem 0.75rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-badge.confirmed {
    background: #28a745;
    color: white;
}

.status-badge.pending {
    background: #ffc107;
    color: #000;
}

.status-badge.cancelled {
    background: #dc3545;
    color: white;
}

.status-badge.refunded {
    background: #6c757d;
    color: white;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    right: 0;
    background: #333;
    min-width: 150px;
    border-radius: 6px;
    border: 1px solid #555;
    z-index: 1;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.dropdown-content a {
    display: block;
    padding: 0.75rem 1rem;
    color: #B3B3B3;
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.dropdown-content a:hover {
    background: #E50914;
    color: white;
}

.dropdown:hover .dropdown-content {
    display: block;
}

.bulk-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-top: 1px solid #333;
    background: #2A2A2A;
}

.bulk-info {
    color: #B3B3B3;
    font-weight: 500;
}

.bulk-buttons {
    display: flex;
    gap: 1rem;
}

.checkbox-label {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    margin: 0;
    margin-right: 0.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.stat-card {
    background: #1F1F1F;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #333;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stat-icon {
    font-size: 2rem;
    opacity: 0.8;
}

.stat-info h3 {
    color: #B3B3B3;
    font-size: 0.9rem;
    margin: 0 0 0.5rem 0;
    font-weight: 500;
}

.stat-info .stat-number {
    color: #FFFFFF;
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 0.25rem 0;
}

.stat-info .stat-change {
    font-size: 0.8rem;
    color: #B3B3B3;
}

.stat-info .stat-change.positive {
    color: #28a745;
}

.stat-info .stat-change.negative {
    color: #dc3545;
}

.modal-content.large {
    max-width: 800px;
    width: 90%;
}

@media (max-width: 768px) {
    .header-stats {
        flex-direction: column;
        gap: 1rem;
    }
    
    .filter-row {
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-group {
        min-width: auto;
    }
    
    .table-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .bulk-actions {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>

<script>
let selectedBookings = new Set();

document.addEventListener('DOMContentLoaded', function() {
    initializeBookingManagement();
});

function initializeBookingManagement() {
    // Initialize select all checkbox
    const selectAllCheckbox = document.getElementById('selectAll');
    const bookingCheckboxes = document.querySelectorAll('input[name="selectedBooking"]');
    
    selectAllCheckbox?.addEventListener('change', function() {
        bookingCheckboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
            if (this.checked) {
                selectedBookings.add(checkbox.value);
            } else {
                selectedBookings.delete(checkbox.value);
            }
        });
        updateBulkActions();
    });
    
    bookingCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            if (this.checked) {
                selectedBookings.add(this.value);
            } else {
                selectedBookings.delete(this.value);
            }
            updateBulkActions();
            
            // Update select all checkbox
            const checkedCount = document.querySelectorAll('input[name="selectedBooking"]:checked').length;
            selectAllCheckbox.checked = checkedCount === bookingCheckboxes.length;
            selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < bookingCheckboxes.length;
        });
    });
    
    // Filter functionality
    setupFilters();
}

function updateBulkActions() {
    const bulkActions = document.getElementById('bulkActions');
    const selectedCount = document.getElementById('selectedCount');
    
    if (selectedBookings.size > 0) {
        bulkActions.style.display = 'flex';
        selectedCount.textContent = selectedBookings.size;
    } else {
        bulkActions.style.display = 'none';
    }
}

function setupFilters() {
    const dateFilter = document.getElementById('dateFilter');
    const statusFilter = document.getElementById('statusFilter');
    const cinemaFilter = document.getElementById('cinemaFilter');
    const searchInput = document.getElementById('bookingSearch');
    
    [dateFilter, statusFilter, cinemaFilter].forEach(filter => {
        filter?.addEventListener('change', filterBookings);
    });
    
    searchInput?.addEventListener('input', filterBookings);
}

function filterBookings() {
    // Mock filter implementation
    console.log('Filtering bookings...');
}

function viewBooking(bookingId) {
    // Mock booking details
    const bookingDetails = `
        <div class="booking-detail-grid">
            <div class="detail-section">
                <h4>Th√¥ng tin ƒë·∫∑t v√©</h4>
                <div class="detail-row">
                    <span class="label">M√£ v√©:</span>
                    <span class="value">#TK${bookingId}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Tr·∫°ng th√°i:</span>
                    <span class="value"><span class="status-badge confirmed">ƒê√£ x√°c nh·∫≠n</span></span>
                </div>
                <div class="detail-row">
                    <span class="label">Ng√†y ƒë·∫∑t:</span>
                    <span class="value">10/11/2025 14:30</span>
                </div>
            </div>
            
            <div class="detail-section">
                <h4>Th√¥ng tin kh√°ch h√†ng</h4>
                <div class="detail-row">
                    <span class="label">T√™n:</span>
                    <span class="value">Nguy·ªÖn VƒÉn A</span>
                </div>
                <div class="detail-row">
                    <span class="label">Email:</span>
                    <span class="value">nguyenvana@email.com</span>
                </div>
                <div class="detail-row">
                    <span class="label">ƒêi·ªán tho·∫°i:</span>
                    <span class="value">0901234567</span>
                </div>
            </div>
            
            <div class="detail-section">
                <h4>Th√¥ng tin phim</h4>
                <div class="detail-row">
                    <span class="label">Phim:</span>
                    <span class="value">Spider-Man: No Way Home</span>
                </div>
                <div class="detail-row">
                    <span class="label">R·∫°p:</span>
                    <span class="value">CGV Vincom Center</span>
                </div>
                <div class="detail-row">
                    <span class="label">Su·∫•t chi·∫øu:</span>
                    <span class="value">15/11/2025 19:30</span>
                </div>
                <div class="detail-row">
                    <span class="label">Gh·∫ø:</span>
                    <span class="value">A1, A2</span>
                </div>
            </div>
            
            <div class="detail-section">
                <h4>Thanh to√°n</h4>
                <div class="detail-row">
                    <span class="label">V√© phim:</span>
                    <span class="value">200,000 VND</span>
                </div>
                <div class="detail-row">
                    <span class="label">ƒê·ªì ƒÉn:</span>
                    <span class="value">40,000 VND</span>
                </div>
                <div class="detail-row">
                    <span class="label">T·ªïng c·ªông:</span>
                    <span class="value"><strong>240,000 VND</strong></span>
                </div>
                <div class="detail-row">
                    <span class="label">Ph∆∞∆°ng th·ª©c:</span>
                    <span class="value">Th·∫ª t√≠n d·ª•ng</span>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('bookingDetails').innerHTML = bookingDetails;
    document.getElementById('bookingDetailModal').style.display = 'flex';
}

function closeBookingModal() {
    document.getElementById('bookingDetailModal').style.display = 'none';
}

function editBooking(bookingId) {
    console.log('Edit booking:', bookingId);
    // Implementation for editing booking
}

function printTicket(bookingId) {
    console.log('Print ticket:', bookingId);
    // Implementation for printing ticket
}

function confirmBooking(bookingId) {
    console.log('Confirm booking:', bookingId);
    // Implementation for confirming booking
}

function cancelBooking(bookingId) {
    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy v√© n√†y?')) {
        console.log('Cancel booking:', bookingId);
        // Implementation for canceling booking
    }
}

function refundBooking(bookingId) {
    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ho√†n ti·ªÅn cho v√© n√†y?')) {
        console.log('Refund booking:', bookingId);
        // Implementation for refunding booking
    }
}

function sendEmail(bookingId) {
    console.log('Send email for booking:', bookingId);
    // Implementation for sending email
}

function bulkConfirm() {
    if (selectedBookings.size > 0 && confirm(`X√°c nh·∫≠n ${selectedBookings.size} v√© ƒë∆∞·ª£c ch·ªçn?`)) {
        console.log('Bulk confirm:', Array.from(selectedBookings));
        selectedBookings.clear();
        updateBulkActions();
    }
}

function bulkCancel() {
    if (selectedBookings.size > 0 && confirm(`H·ªßy ${selectedBookings.size} v√© ƒë∆∞·ª£c ch·ªçn?`)) {
        console.log('Bulk cancel:', Array.from(selectedBookings));
        selectedBookings.clear();
        updateBulkActions();
    }
}

function bulkExport() {
    if (selectedBookings.size > 0) {
        console.log('Bulk export:', Array.from(selectedBookings));
        // Implementation for exporting selected bookings
    }
}

function exportBookings() {
    console.log('Export all bookings');
    // Implementation for exporting all bookings
}

function refreshBookings() {
    console.log('Refresh bookings');
    location.reload();
}

// Close modal when clicking outside
document.getElementById('bookingDetailModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeBookingModal();
    }
});

// Auto-refresh every 30 seconds
setInterval(function() {
    // Auto-refresh booking data
    console.log('Auto-refreshing booking data...');
}, 30000);
</script>

</body>
</html>