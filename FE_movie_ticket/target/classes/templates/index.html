<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!-- This <head> tag will be completely replaced by the content of the fragment -->
<head th:replace="~{fragments/header :: header}"></head>

<body>

<!-- ================================== -->
<!--      HEADER / NAVIGATION           -->
<!-- ================================== -->
<!--
      THIS IS THE MAGIC LINE:
      It finds the 'navbar.html' file inside the 'fragments' folder,
      looks for the piece named 'navbar', and replaces this div with it.
    -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<main>
    <!-- ================================== -->
    <!--      HERO / CYCLE BANNER (SWIPER)  -->
    <!-- ================================== -->
    <!-- 1. The main Swiper container -->
    <div class="swiper hero-swiper">
        <!-- 2. The wrapper for all the slides -->
        <div class="swiper-wrapper">
            <!-- 3. Dynamic Individual Slides from Thymeleaf -->
            <div class="swiper-slide hero-slide" th:each="movie : ${heroSlides}" 
                 th:style="'background-image: url(' + ${movie.backdropUrl != null ? movie.backdropUrl : movie.movieUrl} + ');'">
                <div class="hero-slide-content">
                    <h2 th:text="${movie.title}">Movie Title</h2>
                    <p th:text="${movie.description != null ? movie.description : 'An exciting movie experience awaits you!'}">Movie Description</p>
                    <a th:href="@{/booking/{id}/showtimes(id=${movie.movieId})}" class="btn btn-primary">Book Now</a>
                </div>
            </div>
        </div>

        <!-- 4. Navigation Arrows -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>

        <!-- 5. Pagination Dots -->
        <div class="swiper-pagination"></div>
    </div>


    <!-- ================================== -->
    <!--      MOVIE SELECTION SECTION       -->
    <!-- ================================== -->
    <section class="movie-section container">
        <div class="section-header">
            <h2 class="section-title">Movie Selection</h2>
            <a th:href="@{/movies}" class="see-all-link">See All &rarr;</a>
        </div>
        </div>

        <!-- TABS -->
        <div class="movie-tabs">
            <button class="active">Now Showing</button>
            <button>Coming Soon</button>
        </div>

        <!-- NOW SHOWING GRID (DYNAMIC CONTENT) -->
        <div class="movie-grid active" id="now-showing-grid">
            <!-- Thymeleaf Loop for "Now Showing" Movies -->
            <div class="movie-card" th:each="movie : ${nowShowingMovies}">
                <img th:src="${movie.movieUrl}" alt="Movie Poster">
                <div class="movie-card-content">
                    <h3 th:text="${movie.title}">Movie Title</h3>
                    <p>
                        <span>Action</span> |
                        <span th:text="${movie.duration} + ' min'">Duration</span>
                    </p>
                </div>
                <div class="movie-card-actions">
                    <a th:href="@{/movies/{id}(id=${movie.movieId})}" class="btn btn-secondary">Details</a>
                    <a th:href="@{/booking/{id}/showtimes(id=${movie.movieId})}" class="btn btn-primary">Book Now</a>
                </div>
            </div>
        </div>

        <!-- COMING SOON GRID (DYNAMIC CONTENT) -->
        <div class="movie-grid" id="coming-soon-grid" style="display: none;">
            <!-- Thymeleaf Loop for "Coming Soon" Movies -->
            <div class="movie-card" th:each="movie : ${comingSoonMovies}">
                <img th:src="${movie.movieUrl}" alt="Movie Poster">
                <div class="movie-card-content">
                    <h3 th:text="${movie.title}">Movie Title</h3>
                    <p>
                        <span>Action</span> |
                        <span th:text="${movie.duration} + ' min'">Duration</span>
                    </p>
                </div>
                <div class="movie-card-actions">
                    <a th:href="@{/movies/{id}(id=${movie.movieId})}" class="btn btn-secondary">Details</a>
                    <button class="btn btn-primary" disabled>Coming Soon</button>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- ================================== -->
<!--      FOOTER                        -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- include the Swiper.js library -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<!-- write your script to initialize Swiper -->
<script>
    // This is the JavaScript code that finds the div with the class 'hero-swiper'
    // and turns it into a functional, cycling carousel.
    const swiper = new Swiper('.hero-swiper', {
        // Configuration options
        loop: true,         // Enables continuous looping
        autoplay: {
            delay: 5000,    // Auto-plays every 5 seconds
            disableOnInteraction: false,
        },

        // Activates the pagination dots
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },

        // Activates the navigation arrows
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
    });

    // Tab switching functionality
    document.addEventListener('DOMContentLoaded', function() {
        const tabs = document.querySelectorAll('.movie-tabs button');
        const nowShowingGrid = document.getElementById('now-showing-grid');
        const comingSoonGrid = document.getElementById('coming-soon-grid');

        tabs.forEach((tab, index) => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');

                // Show/hide appropriate grid
                if (index === 0) { // Now Showing
                    nowShowingGrid.style.display = 'grid';
                    comingSoonGrid.style.display = 'none';
                } else { // Coming Soon
                    nowShowingGrid.style.display = 'none';
                    comingSoonGrid.style.display = 'grid';
                }
            });
        });

        // Hero slides image error handling
        const heroSlides = document.querySelectorAll('.hero-slide');
        heroSlides.forEach((slide, index) => {
            const bgImage = slide.style.backgroundImage;
            if (bgImage) {
                const imageUrl = bgImage.slice(4, -1).replace(/"/g, "");
                
                // Test if image loads
                const testImage = new Image();
                testImage.onload = function() {
                    console.log(`✅ Hero slide ${index + 1} image loaded successfully`);
                };
                testImage.onerror = function() {
                    console.log(`❌ Hero slide ${index + 1} image failed, using fallback`);
                    // Use a solid color gradient as fallback
                    slide.style.backgroundImage = 'linear-gradient(135deg, #1F1F1F 0%, #333 50%, #E50914 100%)';
                };
                testImage.src = imageUrl;
            }
        });
    });
</script>
</body>
</html>