<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: header}"></head>

<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<main class="container">
    <div class="date-slider">
        <div class="date-item active"><span class="month">10</span> <span class="day">30</span> <span class="weekday">Thu</span></div>
        <div class="date-item"><span class="month">10</span> <span class="day">31</span> <span class="weekday">Fri</span></div>
        <div class="date-item"><span class="month">11</span> <span class="day">01</span> <span class="weekday">Sat</span></div>
    </div>

    <!-- STEP 1: CHOOSE A CITY -->
    <div id="city-selection" class="selection-container active">
        <h2 class="selection-title">Please Select a City</h2>
        <div class="selection-grid">
            <div class="selection-item" th:each="city : ${cities}" th:data-city-name="${city}" th:text="${city}"></div>
        </div>
    </div>

    <!-- STEP 2: CHOOSE A CINEMA -->
    <div id="cinema-selection" class="selection-container">
        <h2 class="selection-title">Please Select a Cinema in <span id="selected-city-name"></span></h2>
        <div th:each="cityEntry : ${cinemasByCity}">
            <div class="selection-grid cinema-list" th:data-city="${cityEntry.key}">
                <div class="selection-item" th:each="cinema : ${cityEntry.value}" th:text="${cinema.name}"></div>
            </div>
        </div>
        <button id="back-to-city" class="back-btn">&larr; Back to City Selection</button>
    </div>

    <!-- STEP 3: VIEW SHOWTIMES -->
    <div id="showtimes-view" class="selection-container">
        <div class="movie-showtimes-list">
            <div class="movie-listing-block" th:each="movieEntry : ${showtimesByMovie}">
                <div class="movie-poster-column">
                    <img th:src="${movieEntry.key.movieUrl}" alt="Movie Poster">
                </div>
                <div class="movie-details-column">
                    <div class="movie-title-header">
                        <h2 th:text="${movieEntry.key.title}">Movie Title</h2>
                        <span class="rating-tag" th:text="${movieEntry.key.rating}">T13</span>
                    </div>
                    <div class="format-block" th:each="formatEntry : ${movieEntry.value}">
                        <h3 class="format-name" th:text="${formatEntry.key}">2D Phụ Đề Anh</h3>
                        <div class="showtime-buttons">
                            <a th:href="@{/booking/select-seats/{movieId}/{showtimeId}(movieId=${movieEntry.key.id}, showtimeId=${showtime.id})}"
                               class="showtime-btn"
                               th:each="showtime : ${formatEntry.value}">
                                <span class="time" th:text="${showtime.time}">00:00</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button id="back-to-cinema" class="back-btn">&larr; Back to Cinema Selection</button>
    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const citySelection = document.getElementById('city-selection');
        const cinemaSelection = document.getElementById('cinema-selection');
        const showtimesView = document.getElementById('showtimes-view');
        const selectedCitySpan = document.getElementById('selected-city-name');

        citySelection.addEventListener('click', (e) => {
            const targetItem = e.target.closest('.selection-item');
            if (targetItem) {
                const cityName = targetItem.dataset.cityName;
                citySelection.classList.remove('active');
                cinemaSelection.classList.add('active');
                selectedCitySpan.textContent = cityName;
                document.querySelectorAll('.cinema-list').forEach(list => list.style.display = 'none');
                document.querySelector(`.cinema-list[data-city="${cityName}"]`).style.display = 'grid';
            }
        });

        cinemaSelection.addEventListener('click', (e) => {
            if (e.target.closest('.selection-item')) {
                cinemaSelection.classList.remove('active');
                showtimesView.classList.add('active');
            }
        });

        document.getElementById('back-to-city').addEventListener('click', () => {
            cinemaSelection.classList.remove('active');
            citySelection.classList.add('active');
        });

        document.getElementById('back-to-cinema').addEventListener('click', () => {
            showtimesView.classList.remove('active');
            cinemaSelection.classList.add('active');
        });
    });
</script>
</body>
</html>