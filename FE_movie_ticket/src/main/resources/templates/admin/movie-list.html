<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: header}"></head>

<body class="admin-body">

<!-- Admin Navigation -->
<div th:replace="~{admin/fragments/admin-navbar :: admin-navbar}"></div>

<div class="admin-container">
    <!-- Admin Sidebar -->
    <div th:replace="admin/fragments/admin-sidebar :: sidebar"></div>

    <!-- Main Content -->
    <main class="admin-main-content">
        <div class="admin-header">
            <h1>Qu·∫£n l√Ω Phim</h1>
            <div class="header-actions">
                <a href="/admin/movies/add" class="btn btn-primary">
                    ‚ûï Th√™m Phim M·ªõi
                </a>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-section">
            <div class="filter-controls">
                <div class="filter-group">
                    <label>Tr·∫°ng th√°i:</label>
                    <select class="form-select">
                        <option value="">T·∫•t c·∫£ phim</option>
                        <option value="NOW_SHOWING">ƒêang chi·∫øu</option>
                        <option value="COMING_SOON">S·∫Øp chi·∫øu</option>
                        <option value="ENDED">Ng·ª´ng chi·∫øu</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Th·ªÉ lo·∫°i:</label>
                    <select class="form-select">
                        <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
                        <option value="Action">H√†nh ƒë·ªông</option>
                        <option value="Comedy">H√†i</option>
                        <option value="Drama">T√¢m l√Ω</option>
                        <option value="Horror">Kinh d·ªã</option>
                        <option value="Sci-Fi">Khoa h·ªçc vi·ªÖn t∆∞·ªüng</option>
                    </select>
                </div>
                <div class="search-group">
                    <input type="text" placeholder="T√¨m ki·∫øm phim..." class="search-input">
                    <button class="search-btn">üîç</button>
                </div>
            </div>
        </div>

        <!-- Movies Table -->
        <div class="content-card">
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Poster</th>
                            <th>T√™n phim</th>
                            <th>Th·ªÉ lo·∫°i</th>
                            <th>Th·ªùi l∆∞·ª£ng</th>
                            <th>Ng√†y kh·ªüi chi·∫øu</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Doanh thu</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="movie : ${movies}">
                            <td>
                                <img th:src="${movie.poster}" 
                                     th:alt="${movie.title} + ' Poster'" 
                                     class="table-poster">
                            </td>
                            <td>
                                <div class="movie-info">
                                    <h4 th:text="${movie.title}">Movie Title</h4>
                                    <p class="movie-rating" th:text="${movie.rating}">Rating</p>
                                </div>
                            </td>
                            <td th:text="${movie.genre}">Genre</td>
                            <td th:text="${movie.duration} + ' ph√∫t'">Duration</td>
                            <td th:text="${movie.releaseDate}">Release Date</td>
                            <td>
                                <span class="status-badge" 
                                      th:classappend="${movie.status.toLowerCase().replace('_', '-')}"
                                      th:text="${movie.status == 'NOW_SHOWING' ? 'ƒêang chi·∫øu' : 
                                                (movie.status == 'COMING_SOON' ? 'S·∫Øp chi·∫øu' : 'Ng·ª´ng chi·∫øu')}">Status</span>
                            </td>
                            <td>
                                <strong th:text="${#numbers.formatDecimal(movie.revenue, 0, 'COMMA', 0, 'POINT')} + ' VND'">Revenue</strong>
                                <br><small th:text="${movie.ticketsSold} + ' v√©'">Tickets</small>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a th:href="@{/admin/movies/edit/{id}(id=${movie.id})}" class="btn-action btn-edit" title="Ch·ªânh s·ª≠a">‚úèÔ∏è</a>
                                    <a th:href="@{/admin/movies/schedule/{id}(id=${movie.id})}" class="btn-action btn-schedule" title="L·ªãch chi·∫øu">üìÖ</a>
                                    <a th:href="@{/admin/movies/analytics/{id}(id=${movie.id})}" class="btn-action btn-analytics" title="Th·ªëng k√™">üìä</a>
                                    <button class="btn-action btn-delete" title="X√≥a" th:onclick="'confirmDelete(' + ${movie.id} + ')'">üóëÔ∏è</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="table-pagination">
                <div class="pagination-info">
                    Hi·ªÉn th·ªã <span th:text="${#lists.size(movies)}">0</span> phim
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" disabled>‚Üê Tr∆∞·ªõc</button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">3</button>
                    <button class="pagination-btn">Sau ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions" style="display: none;">
            <div class="bulk-controls">
                <span class="selected-count">0 movies selected</span>
                <div class="bulk-buttons">
                    <button class="btn btn-secondary">Update Status</button>
                    <button class="btn btn-outline">Export</button>
                    <button class="btn btn-danger">Delete Selected</button>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <button class="modal-close" onclick="closeDeleteModal()">√ó</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this movie? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
        </div>
    </div>
</div>

<script>
// Delete confirmation
function confirmDelete(movieId) {
    document.getElementById('deleteModal').style.display = 'flex';
    document.getElementById('confirmDeleteBtn').onclick = function() {
        // Handle delete action here
        console.log('Deleting movie with ID:', movieId);
        closeDeleteModal();
    };
}

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
    const statusFilter = document.querySelector('select[name="status"]');
    const genreFilter = document.querySelector('select[name="genre"]');
    const searchInput = document.querySelector('.search-input');

    // Add event listeners for filtering
    // Implementation would go here
});
</script>

<style>
.filter-section {
    background-color: var(--color-surface);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid #333;
}

.filter-controls {
    display: flex;
    gap: 20px;
    align-items: end;
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.filter-group label {
    font-size: 0.9em;
    color: var(--color-text-secondary);
    font-weight: 500;
}

.form-select {
    background-color: #333;
    color: var(--color-text-primary);
    border: 1px solid #444;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 0.95em;
    min-width: 150px;
}

.search-group {
    display: flex;
    gap: 5px;
}

.search-input {
    background-color: #333;
    color: var(--color-text-primary);
    border: 1px solid #444;
    border-radius: 6px 0 0 6px;
    padding: 8px 12px;
    font-size: 0.95em;
    min-width: 200px;
    outline: none;
}

.search-btn {
    background-color: var(--color-primary);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 0 6px 6px 0;
    cursor: pointer;
}

.content-card {
    background-color: var(--color-surface);
    border-radius: 12px;
    border: 1px solid #333;
    overflow: hidden;
}

.table-container {
    overflow-x: auto;
}

.table-poster {
    width: 60px;
    height: 90px;
    border-radius: 6px;
    object-fit: cover;
}

.movie-info h4 {
    margin: 0 0 5px 0;
    font-size: 1em;
    color: var(--color-text-primary);
}

.movie-rating {
    margin: 0;
    font-size: 0.8em;
    color: var(--color-text-secondary);
    background-color: #333;
    padding: 2px 6px;
    border-radius: 4px;
    display: inline-block;
}

.status-badge.now-showing {
    background-color: #28a745;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: 500;
}

.status-badge.coming-soon {
    background-color: #ffc107;
    color: #000;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: 500;
}

.status-badge.ended {
    background-color: #6c757d;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: 500;
}

.table-pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    border-top: 1px solid #333;
    background-color: rgba(0, 0, 0, 0.2);
}

.pagination-info {
    color: var(--color-text-secondary);
    font-size: 0.9em;
}

.pagination-controls {
    display: flex;
    gap: 5px;
}

.pagination-btn {
    background-color: #333;
    color: var(--color-text-primary);
    border: 1px solid #444;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    transition: all 0.3s;
}

.pagination-btn:hover:not(:disabled) {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
}

.pagination-btn.active {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.bulk-actions {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--color-surface);
    border: 1px solid #333;
    border-radius: 10px;
    padding: 15px 20px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.bulk-controls {
    display: flex;
    align-items: center;
    gap: 20px;
}

.selected-count {
    color: var(--color-text-secondary);
    font-size: 0.9em;
}

.bulk-buttons {
    display: flex;
    gap: 10px;
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.modal-content {
    background-color: var(--color-surface);
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    border: 1px solid #333;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    border-bottom: 1px solid #333;
}

.modal-header h3 {
    margin: 0;
    color: var(--color-text-primary);
}

.modal-close {
    background: none;
    border: none;
    color: var(--color-text-secondary);
    font-size: 1.5em;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
}

.modal-close:hover {
    background-color: #333;
    color: var(--color-text-primary);
}

.modal-body {
    padding: 25px;
    color: var(--color-text-secondary);
    line-height: 1.6;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 20px 25px;
    border-top: 1px solid #333;
}
</style>

</body>
</html>